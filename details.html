<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Document Details – Step 3 | E-LegalBoom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="style.css"/>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f8fb;
      color: #0f172a;
    }

    .page {
      max-width: 960px;
      margin: 28px auto 48px;
      padding: 0 18px;
    }

    h1 {
      font-size: 1.9rem;
      margin-bottom: 6px;
      color: #0b7285;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #475569;
      max-width: 780px;
      line-height: 1.5;
    }

    .summary {
      margin-top: 14px;
      padding: 12px 14px;
      background: #ecfeff;
      border-left: 4px solid #0b7285;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #1e293b;
    }

    .summary strong {
      color: #0b7285;
    }

    form {
      margin-top: 18px;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      padding: 18px 16px 20px;
      box-shadow: 0 10px 24px rgba(15,23,42,0.06);
    }

    .section {
      margin-top: 18px;
      border-top: 1px solid #e5e7eb;
      padding-top: 12px;
    }

    .section h2 {
      font-size: 1.05rem;
      margin: 0 0 8px;
      color: #0f172a;
    }

    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    input[type="text"],
    input[type="email"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .hint {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: -4px;
      margin-bottom: 6px;
    }

    .btn-row {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
    }

    button[type="submit"] {
      background: #0b7285;
      color: #ffffff;
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(11,114,133,0.35);
    }

    button[type="submit"]:disabled {
      opacity: 0.6;
      cursor: progress;
      box-shadow: none;
    }

    .status {
      margin-top: 12px;
      font-size: 0.9rem;
    }

    .status.error {
      color: #b91c1c;
    }

    .status.success {
      color: #166534;
    }

    .post-actions {
      margin-top: 20px;
      display: none;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-pill {
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 0.85rem;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #0b7285;
      color: #ffffff;
      box-shadow: 0 10px 24px rgba(11,114,133,0.35);
    }

    .btn-secondary {
      border: 1px solid #0b7285;
      color: #0b7285;
      background: #ffffff;
    }
  </style>
</head>

<body>

<section class="page">
  <h1>Document Details – Step 3</h1>
  <p class="subtitle">
    This step gathers the information required to prepare your document accurately.
    Please be as clear and specific as possible. If something does not apply, you may leave it blank.
  </p>

  <div class="summary">
    Tier: <strong><span id="tierLabel">(not set)</span></strong><br/>
    Document: <strong><span id="docLabel">(not set)</span></strong><br/>
    Intake ID: <span id="intakeDisplay">(not set)</span>
  </div>

  <form id="detailsForm">
    <!-- Hidden fields -->
    <input type="hidden" id="tierCode" name="tierCode" value="">
    <input type="hidden" id="intakeId" name="intakeId" value="">
    <input type="hidden" id="docType" name="docType" value="">
    <input type="hidden" id="stage" name="stage" value="intake2">

    <div class="section">
      <h2>Parties Involved</h2>

      <label for="partyOneName">Your name / entity name</label>
      <input type="text" id="partyOneName" name="partyOneName">

      <label for="partyTwoName">Other party name (person or business)</label>
      <input type="text" id="partyTwoName" name="partyTwoName">

      <label for="partyRelationship">How are the parties connected?</label>
      <textarea id="partyRelationship" name="partyRelationship"
                placeholder="Example: I am hiring this person as a contractor to provide security services at my property."></textarea>
    </div>

    <div class="section">
      <h2>Key Terms</h2>

      <label for="keyAmounts">Key amounts (if any)</label>
      <textarea id="keyAmounts" name="keyAmounts"
                placeholder="Example: Loan amount, payment schedule, consulting fee, monthly service amount, etc."></textarea>

      <label for="timing">Timing or term of the agreement</label>
      <textarea id="timing" name="timing"
                placeholder="Example: 6-month term, starting March 1, 2026, or month-to-month with 30 days’ notice."></textarea>

      <label for="specialClauses">Any special clauses or conditions to include?</label>
      <textarea id="specialClauses" name="specialClauses"
                placeholder="Example: Non-compete, late fees, early termination terms, communication expectations, etc."></textarea>
    </div>

    <div class="section">
      <h2>Anything Else We Should Know?</h2>
      <label for="extraNotes">Additional context or instructions</label>
      <textarea id="extraNotes" name="extraNotes"
                placeholder="Anything specific you want reflected in this agreement or that we should be aware of."></textarea>
    </div>

    <div class="btn-row">
      <button type="submit">Submit Details</button>
    </div>

    <div class="status" id="statusMessage"></div>
  </form>

  <div id="postActions" class="post-actions">
    <a id="anotherSameTier" class="btn-pill btn-primary" href="#">
      Order another document in this tier →
    </a>
    <a class="btn-pill btn-secondary" href="catalog.html">
      Choose a different tier →
    </a>
  </div>
</section>

<script>
  const SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbxirMiGTQ0QmUGLUxCcuSX1_qasnfRxBL1ycs08z-LTmF9CxgHeivGrVqGi2D_MuRpt/exec";

  function getParam(name) {
    return new URLSearchParams(window.location.search).get(name) || "";
  }

  function tierLabel(code) {
    if (code === "T1") return "Tier 1 – Startup & Essential Documents";
    if (code === "T2") return "Tier 2 – Business Foundation Documents";
    if (code === "T3") return "Tier 3 – Premium Business Agreements";
    if (code === "ENT") return "Entrepreneur Starter Bundle";
    return "(not set)";
  }

  function prettyDoc(code) {
    const map = {
      NDA: "Mutual NDA",
      PROMISSORY_NOTE: "Promissory Note",
      SINGLE_MEMBER_LLC: "Single-Member LLC Agreement",
      PARTNERSHIP: "Partnership Agreement",
      TWO_MEMBER_LLC: "Two-Member LLC Agreement",
      BUY_SELL: "Buy–Sell / Investor Agreement",
      SERVICE: "Service / Contractor Agreement",
      CONSULTING: "Consulting Agreement",
      JV: "Joint Venture Agreement",
      OTHER: "Custom Document"
    };
    return map[code] || "(not specified)";
  }

  document.addEventListener("DOMContentLoaded", () => {
    const tier = getParam("tier").toUpperCase();
    const intakeId = getParam("intakeId");
    const docType = getParam("docType");

    document.getElementById("tierCode").value = tier;
    document.getElementById("intakeId").value = intakeId;
    document.getElementById("docType").value = docType;

    document.getElementById("tierLabel").textContent = tierLabel(tier);
    document.getElementById("docLabel").textContent = prettyDoc(docType);
    document.getElementById("intakeDisplay").textContent = intakeId || "(not set)";

    const form = document.getElementById("detailsForm");
    const statusEl = document.getElementById("statusMessage");
    const postActions = document.getElementById("postActions");
    const anotherSameTier = document.getElementById("anotherSameTier");

    // Configure reorder link: go back to intake with prefillId = this intakeId
    if (tier && intakeId) {
      const url = new URL(window.location.origin + "/intake.html");
      url.searchParams.set("tier", tier);
      url.searchParams.set("prefillId", intakeId);
      // For static hosting on same folder, keep relative form:
      const relative = `intake.html?tier=${encodeURIComponent(tier)}&prefillId=${encodeURIComponent(intakeId)}`;
      anotherSameTier.href = relative;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status";

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting…";

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const resp = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const json = await resp.json();
        if (!json.success) {
          throw new Error(json.error || "Unknown error");
        }

        statusEl.textContent = "Details received. Your document will now move into preparation.";
        statusEl.classList.add("success");
        submitBtn.disabled = true;
        submitBtn.textContent = "Submitted";

        // Show reorder options
        postActions.style.display = "flex";

      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "There was a problem saving your details. Please try again or contact us if this continues.";
        statusEl.classList.add("error");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Details";
      }
    });
  });
</script>

</body>
</html>
