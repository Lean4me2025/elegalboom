<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>E-LegalBoom Review & Pay</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; padding: 40px; }
.card { max-width: 520px; border:1px solid #ccc; padding:20px; }
button { background:#2a5bd7; color:white; border:none; padding:15px; width:100%; }
</style>
</head>

<body>

<div class="card">
<h2>Review Your Information</h2>
<div id="review"></div>
<button id="payBtn">Proceed To Payment</button>
</div>

<script>

// --------------------
// Supabase
// --------------------

const SUPABASE_URL = "https://vvbjflqsvvvxmfwi.supabase.co"
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q"

const supabase = window.supabase.createClient(
 SUPABASE_URL,
 SUPABASE_ANON_KEY
)


// --------------------
// Load Intake
// --------------------

const intake = JSON.parse(sessionStorage.getItem("intakeData"))

if(!intake){
 alert("Missing intake data")
 window.location = "catalog.html"
}


// --------------------
// Render Review
// --------------------

document.getElementById("review").innerHTML = `
<p><b>Tier:</b> ${intake.tier}</p>
<p><b>Document:</b> ${intake.doc_type}</p>
<p><b>Price:</b> $${intake.price}</p>
<p><b>Name:</b> ${intake.client_first} ${intake.client_last}</p>
<p><b>Email:</b> ${intake.client_email}</p>
<p><b>Phone:</b> ${intake.client_phone}</p>
`


// --------------------
// Payment Link Map
// --------------------

function getPaymentLink(tier){

const map = {

"tier1":"https://pay.elegalboom.org/e4b79a60-0fd7-431c-8bfc-ae0",

"tier2":"https://pay.elegalboom.org/aeda586f-65f5-4bf0-9813-7a2",

"tier3":"https://pay.elegalboom.org/71ca7144-e537-4fbd-823d-c10",

"tier4":"https://pay.elegalboom.org/55c7cd3d-1048-4b8c-aadb-843"

}

return map[(tier || "").toLowerCase()]
}


// --------------------
// Payment Button
// --------------------

document.getElementById("payBtn").onclick = async () => {

try {

const { error } = await supabase
.from("pweb_orders")
.insert([intake])

if(error){
 console.error(error)
 alert("Database insert failed")
 return
}

const link = getPaymentLink(intake.tier)

if(!link){
 alert("Payment link missing for tier")
 return
}

window.location = link

}
catch(e){
 console.error(e)
 alert("System error")
}

}

</script>

</body>
</html>
