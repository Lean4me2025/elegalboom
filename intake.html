<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom | Personal & Business Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f3f4f8;
      color: #111827;
      min-height: 100vh;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Site header */
    .site-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 24px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
    }

    .site-brand {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
    }

    .site-nav a {
      margin-left: 18px;
      font-size: 14px;
      color: #374151;
    }

    .site-nav a:hover {
      color: #1d4ed8;
      text-decoration: underline;
    }

    /* Page */
    .page {
      max-width: 960px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    .back-link {
      font-size: 13px;
      color: #1d4ed8;
      margin-bottom: 10px;
      display: inline-block;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 14px;
    }

    .context-box {
      background: #e0f2fe;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 13px;
      color: #075985;
      margin-bottom: 18px;
    }

    .context-box strong {
      font-weight: 600;
    }

    .form-card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 18px 18px 20px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-bottom: 12px;
    }

    .field {
      flex: 1 1 220px;
      display: flex;
      flex-direction: column;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      color: #111827;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea {
      border-radius: 6px;
      border: 1px solid #d1d5db;
      padding: 8px 9px;
      font-size: 14px;
      outline: none;
      background: #ffffff;
    }

    input:focus,
    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .helper {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .actions {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-primary,
    .btn-secondary {
      display: inline-block;
      padding: 9px 16px;
      border-radius: 999px;
      font-size: 14px;
      text-decoration: none;
      text-align: center;
      min-width: 190px;
      cursor: pointer;
    }

    .btn-primary {
      background: #0f766e;
      color: #ffffff;
      border: 1px solid #0f766e;
    }

    .btn-primary:hover {
      background: #115e59;
    }

    .btn-secondary {
      background: #ffffff;
      color: #2563eb;
      border: 1px solid #2563eb;
    }

    .btn-secondary:hover {
      background: #e0edff;
    }

    .notice {
      font-size: 12px;
      color: #6b7280;
      margin-top: 10px;
    }

    .status {
      margin-top: 12px;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #bbf7d0;
      background: #dcfce7;
      color: #065f46;
      display: none;
    }

    .status.error {
      border-color: #fecaca;
      background: #fee2e2;
      color: #991b1b;
    }

    @media (max-width: 640px) {
      .site-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="site-brand">E-LegalBoom</div>
    <nav class="site-nav">
      <a href="index.html">Home</a>
      <a href="catalog.html">Catalog</a>
      <a href="orders.html">My Orders</a>
    </nav>
  </header>

  <main class="page">
    <a href="catalog.html" id="back-link" class="back-link">&larr; Back to catalog</a>

    <h1 class="title">Personal &amp; Business Intake</h1>
    <p class="subtitle">
      This short intake gives us the information we need to prepare your document correctly for the right tier and document type.
    </p>

    <div class="context-box" id="context-box">
      <div><strong>Selected Tier:</strong> <span id="tier-label">Tier 1</span></div>
      <div><strong>Selected Document:</strong> <span id="doc-label">To be selected</span></div>
    </div>

    <section class="form-card">
      <!-- NO external action: this form is handled by JavaScript -->
      <form id="intake-form">
        <!-- Hidden fields we carry along -->
        <input type="hidden" id="tier" name="tier" value="" />
        <input type="hidden" id="doc" name="doc" value="" />

        <div class="form-row">
          <div class="field">
            <label for="firstName">First Name *</label>
            <input type="text" id="firstName" name="firstName" required />
          </div>
          <div class="field">
            <label for="lastName">Last Name *</label>
            <input type="text" id="lastName" name="lastName" required />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required />
            <div class="helper">We’ll send your completed document to this address.</div>
          </div>
          <div class="field">
            <label for="phone">Phone (optional)</label>
            <input type="tel" id="phone" name="phone" />
          </div>
        </div>

        <div class="form-row">
          <div class="field">
            <label for="businessName">Business Name (if any)</label>
            <input type="text" id="businessName" name="businessName" />
          </div>
          <div class="field">
            <label for="state">Primary State *</label>
            <input type="text" id="state" name="state" placeholder="CA, TX, NY…" required />
            <div class="helper">State where this document will primarily be used.</div>
          </div>
        </div>

        <div class="form-row">
          <div class="field" style="flex: 1 1 100%;">
            <label for="notes">Anything specific we should know?</label>
            <textarea id="notes" name="notes" placeholder="Optional: describe your situation in a sentence or two."></textarea>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">
            Continue &amp; Pay
          </button>
          <a href="catalog.html" class="btn-secondary">Cancel &amp; return to catalog</a>
        </div>

        <p class="notice">
          After you submit, we’ll save your intake and immediately send you to the secure payment page for this tier.
        </p>

        <div id="status" class="status"></div>
      </form>
    </section>
  </main>

  <script>
    // ---------- Helpers & config ----------
    const LOCAL_ORDERS_KEY = "elegalboom_orders_v1";

    const tierMap = {
      "1": "Tier 1 – Startup & Essential Documents",
      "2": "Tier 2 – Business Foundation Documents",
      "3": "Tier 3 – Premium Business Agreements",
      "bundle": "Entrepreneur Starter Bundle"
    };

    const docMap = {
      "mutual-nda": "Mutual NDA (Non-Disclosure Agreement)",
      "promissory-note": "Promissory Note",
      "single-member-llc": "Single-Member LLC Operating Agreement",
      "payment-iou": "Simple Payment / IOU Agreement",
      "basic-contractor": "Basic Contractor / Service Letter",
      "other-basic-business": "Other Basic Business Forms",
      "partnership-agreement": "Partnership Agreement",
      "two-member-llc": "Two-Member LLC Agreement",
      "buy-sell": "Buy–Sell / Investor Arrangement",
      "other-core-business": "Other Core Business Agreements",
      "service-independent": "Service / Independent Contractor Agreement",
      "consulting": "Consulting and Professional Services Agreement",
      "joint-venture": "Joint Venture / Founder Arrangement",
      "custom-structured": "Custom Structured Agreement",
      "tier1-set": "Tier 1 Document Types (Bundle)",
      "tier2-set": "Tier 2 Document Types (Bundle)",
      "tier3-set": "Tier 3 Document Types (Bundle)",
      "one-intake-per-doc": "One Intake per Document (Bundle)"
    };

    function getPaymentUrl(tier) {
      switch (tier) {
        case "1":
          return "pay-tier1.html";
        case "2":
          return "pay-tier2.html";
        case "3":
          return "pay-tier3.html";
        case "bundle":
          return "pay-bundle.html";
        default:
          return "pay-tier1.html";
      }
    }

    function saveOrder(order) {
      const existingRaw = localStorage.getItem(LOCAL_ORDERS_KEY);
      let list = [];
      if (existingRaw) {
        try {
          list = JSON.parse(existingRaw);
          if (!Array.isArray(list)) list = [];
        } catch (e) {
          list = [];
        }
      }
      list.push(order);
      localStorage.setItem(LOCAL_ORDERS_KEY, JSON.stringify(list));
      // Also mark "last order" for quick admin access
      localStorage.setItem("elegalboom_last_order", JSON.stringify(order));
    }

    function showStatus(message, isError) {
      const box = document.getElementById("status");
      box.textContent = message;
      box.classList.toggle("error", !!isError);
      box.style.display = "block";
    }

    // ---------- Initial URL parsing ----------
    (function initFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const tierParam = params.get("tier") || "1";
      const docParam = params.get("doc") || "";

      document.getElementById("tier").value = tierParam;
      document.getElementById("doc").value = docParam;

      document.getElementById("tier-label").textContent =
        tierMap[tierParam] || "Tier 1";

      document.getElementById("doc-label").textContent =
        docMap[docParam] || (docParam ? docParam : "Selected from tier page");

      const backLink = document.getElementById("back-link");
      if (tierParam === "1") backLink.href = "tier1.html";
      else if (tierParam === "2") backLink.href = "tier2.html";
      else if (tierParam === "3") backLink.href = "tier3.html";
      else if (tierParam === "bundle") backLink.href = "bundle.html";
      else backLink.href = "catalog.html";
    })();

    // ---------- Form submit: save locally + redirect to pay ----------
    document.getElementById("intake-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const tier = document.getElementById("tier").value || "1";
      const doc = document.getElementById("doc").value || "";

      const order = {
        id: Date.now().toString(),
        createdAt: new Date().toISOString(),
        tier,
        documentCode: doc,
        firstName: document.getElementById("firstName").value.trim(),
        lastName: document.getElementById("lastName").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        businessName: document.getElementById("businessName").value.trim(),
        state: document.getElementById("state").value.trim(),
        notes: document.getElementById("notes").value.trim()
      };

      try {
        saveOrder(order);
      } catch (err) {
        console.error("Local save error", err);
        showStatus("We had trouble saving locally. You can still continue to payment.", true);
      }

      const payUrl = getPaymentUrl(tier);
      showStatus("Intake saved. Redirecting you to secure payment…", false);

      setTimeout(function () {
        const url = new URL(payUrl, window.location.origin);
        url.searchParams.set("orderId", order.id);
        url.searchParams.set("tier", tier);
        if (doc) url.searchParams.set("doc", doc);
        window.location.href = url.toString();
      }, 700);
    });
  </script>
</body>
</html>
