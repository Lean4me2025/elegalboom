<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom | Document Intake</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f5f6f8;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background:#ffffff;
      padding:30px;
      border-radius:6px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .summary {
      background:#eef2f8;
      padding:15px;
      margin-bottom:20px;
      border-radius:4px;
    }
    .field {
      margin-bottom:14px;
    }
    label {
      display:block;
      font-weight:bold;
      margin-bottom:4px;
    }
    input {
      width:100%;
      padding:8px;
    }
    .btn {
      margin-top:20px;
      padding:12px 18px;
      font-size:16px;
    }
    .btn:disabled {
      opacity:0.5;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Document Intake</h1>

  <!-- ANCHORED ORDER SUMMARY -->
  <div class="summary">
    <p><strong>Document Type:</strong> <span id="docType"></span></p>
    <p><strong>Tier:</strong> <span id="tier"></span></p>
    <p><strong>Price:</strong> $<span id="price"></span></p>
  </div>

  <!-- INTAKE FORM -->
  <form id="intakeForm"></form>

  <button id="continueBtn" class="btn" disabled>
    Continue to Review & Pay
  </button>

</div>

<script>
/* ======================================================
   RECEIVE INTENT (PASSIVE, NO GUARDS)
====================================================== */

// Canonical read ONLY
const order =
  JSON.parse(sessionStorage.getItem("order")) || {
    doc_type: sessionStorage.getItem("doc_type"),
    tier: sessionStorage.getItem("tier"),
    price: sessionStorage.getItem("price")
  };

// Anchor values immediately (visible = real)
const doc_type = order.doc_type || "";
const tier = order.tier || "";
const price = order.price || "";

document.getElementById("docType").textContent = doc_type;
document.getElementById("tier").textContent = tier;
document.getElementById("price").textContent = price;

/* ======================================================
   FIELD FACTORY
====================================================== */

function field(name, label, type = "text") {
  return { name, label, type };
}

/* ======================================================
   DOCUMENT FLEX MAP (CATALOG-LOCKED)
====================================================== */

const FLEX = {

  "Promissory Note": [
    field("lender_name","Lender Name"),
    field("borrower_name","Borrower Name"),
    field("loan_amount","Loan Amount","number"),
    field("interest_rate","Interest Rate (%)","number"),
    field("repayment_date","Repayment Date","date")
  ],

  "Non-Disclosure Agreement": [
    field("disclosing_party","Disclosing Party"),
    field("receiving_party","Receiving Party"),
    field("effective_date","Effective Date","date")
  ],

  "Independent Contractor Agreement": [
    field("company_name","Company Name"),
    field("contractor_name","Contractor Name"),
    field("scope_of_work","Scope of Work"),
    field("payment_terms","Payment Terms")
  ],

  "Bill of Sale": [
    field("seller_name","Seller Name"),
    field("buyer_name","Buyer Name"),
    field("item_description","Item Description"),
    field("sale_price","Sale Price","number")
  ],

  "Operating Agreement (LLC)": [
    field("llc_name","LLC Name"),
    field("state","State of Formation"),
    field("member_names","Member Names"),
    field("effective_date","Effective Date","date")
  ],

  "Partnership Agreement": [
    field("business_name","Business Name"),
    field("partner_names","Partner Names"),
    field("profit_split","Profit Split")
  ],

  "Business Loan Agreement": [
    field("lender_name","Lender Name"),
    field("borrower_name","Borrower Name"),
    field("loan_amount","Loan Amount","number"),
    field("interest_rate","Interest Rate (%)","number")
  ],

  "Service Agreement": [
    field("service_provider","Service Provider"),
    field("client_name","Client Name"),
    field("services","Services Provided"),
    field("payment_terms","Payment Terms")
  ],

  "Employment Agreement": [
    field("employer_name","Employer Name"),
    field("employee_name","Employee Name"),
    field("position","Position"),
    field("salary","Salary","number")
  ],

  "Residential Lease Agreement": [
    field("landlord_name","Landlord Name"),
    field("tenant_name","Tenant Name"),
    field("property_address","Property Address"),
    field("monthly_rent","Monthly Rent","number")
  ],

  "Commercial Lease Agreement": [
    field("landlord_name","Landlord Name"),
    field("tenant_name","Tenant Name"),
    field("property_address","Property Address"),
    field("lease_term","Lease Term")
  ],

  "Non-Compete Agreement": [
    field("employee_name","Employee Name"),
    field("company_name","Company Name"),
    field("restriction_period","Restriction Period")
  ]
};

/* ======================================================
   RENDER FORM (RECEIVE-ONLY)
====================================================== */

const form = document.getElementById("intakeForm");
const btn = document.getElementById("continueBtn");

const fields = FLEX[doc_type] || [];

fields.forEach(f => {
  const wrap = document.createElement("div");
  wrap.className = "field";

  const label = document.createElement("label");
  label.textContent = f.label;

  const input = document.createElement("input");
  input.type = f.type;
  input.name = f.name;
  input.required = true;

  wrap.appendChild(label);
  wrap.appendChild(input);
  form.appendChild(wrap);
});

/* ======================================================
   VALIDATION (LOCAL ONLY)
====================================================== */

form.addEventListener("input", () => {
  const required = [...form.querySelectorAll("input[required]")];
  btn.disabled = !required.every(i => i.value.trim() !== "");
});

/* ======================================================
   BUILD ORDER LINE â†’ REVIEW & PAY
====================================================== */

btn.onclick = () => {

  const intake_data = {};

  form.querySelectorAll("input").forEach(i => {
    intake_data[i.name] = i.value;
  });

  const order_line = {
    doc_type: doc_type,
    tier: tier,
    price: price,
    intake_data: intake_data
  };

  // Persist ONE canonical payload
  sessionStorage.setItem("intake", JSON.stringify(order_line));

  window.location.href = "review-and-pay.html";
};
</script>

</body>
</html>
