<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom | Client Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 820px; margin: 40px auto; }
    label { display:block; margin-top:18px; font-weight:600; }
    input, select, textarea { width:100%; padding:8px; margin-top:6px; }
    textarea { min-height:90px; }
    h2 { margin-top:40px; }
    button { margin-top:30px; padding:12px 18px; font-size:16px; }
  </style>
</head>

<body>

<h1>Client Intake</h1>

<form id="intakeForm">

  <!-- CLIENT INFORMATION -->
  <h2>Client Information</h2>

  <label>First Name</label>
  <input id="clientFirstName" required />

  <label>Last Name</label>
  <input id="clientLastName" required />

  <label>Email</label>
  <input id="clientEmail" type="email" required />

  <label>Phone</label>
  <input id="clientPhone" />

  <label>Business / Entity Name</label>
  <input id="clientBusiness" />

  <label>State / Jurisdiction</label>
  <select id="state" required>
    <option value="">Select State</option>
    <option>Alabama</option><option>Alaska</option><option>Arizona</option><option>Arkansas</option>
    <option>California</option><option>Colorado</option><option>Connecticut</option><option>Delaware</option>
    <option>Florida</option><option>Georgia</option><option>Hawaii</option><option>Idaho</option>
    <option>Illinois</option><option>Indiana</option><option>Iowa</option><option>Kansas</option>
    <option>Kentucky</option><option>Louisiana</option><option>Maine</option><option>Maryland</option>
    <option>Massachusetts</option><option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
    <option>Missouri</option><option>Montana</option><option>Nebraska</option><option>Nevada</option>
    <option>New Hampshire</option><option>New Jersey</option><option>New Mexico</option><option>New York</option>
    <option>North Carolina</option><option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
    <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option><option>South Carolina</option>
    <option>South Dakota</option><option>Tennessee</option><option>Texas</option><option>Utah</option>
    <option>Vermont</option><option>Virginia</option><option>Washington</option><option>West Virginia</option>
    <option>Wisconsin</option><option>Wyoming</option>
  </select>

  <!-- MATTER DETAILS -->
  <h2>Matter Details</h2>

  <label>Counterparty / Other Party</label>
  <input id="counterparty" />

  <label>Purpose of Document</label>
  <textarea id="purpose"></textarea>

  <label>Amount (if applicable)</label>
  <input id="amount" type="number" />

  <label>Effective Date</label>
  <input id="effectiveDate" type="date" />

  <label>Additional Notes / Instructions</label>
  <textarea id="notes"></textarea>

  <button type="submit">Continue</button>
</form>

<!-- SUPABASE (ESM, NO GLOBAL, NO supabase NAME) -->
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const base = createClient(
    "https://vvjbjfltqsivvxxifnvi.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q"
  );

  document.getElementById("intakeForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
      request_uuid: crypto.randomUUID(),

      client_first_name: clientFirstName.value.trim(),
      client_last_name: clientLastName.value.trim(),
      client_email: clientEmail.value.trim(),
      client_phone: clientPhone.value.trim(),
      client_business_name: clientBusiness.value.trim(),

      state: state.value,
      counterparty: counterparty.value.trim(),
      purpose: purpose.value.trim(),
      amount: amount.value ? Number(amount.value) : null,
      effective_date: effectiveDate.value || null,
      notes: notes.value.trim()
    };

    const { error } = await base
      .from("pweb_orders")
      .insert(payload);

    if (error) {
      console.error(error);
      alert("Database insert failed.");
      return;
    }

    alert("Intake saved successfully.");
  });
</script>

</body>
</html>
