<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom Client Intake</title>

  <!-- Backend Client (vendor-agnostic use) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1, h2 { margin-top: 30px; }
    label { display: block; margin-top: 12px; }
    input, select, textarea { width: 100%; padding: 6px; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>

<h1>E-LegalBoom Client Intake</h1>

<form id="intakeForm">

  <!-- CLIENT -->
  <h2>Client Information</h2>
  <label>First Name <input name="client_first_name" required></label>
  <label>Last Name <input name="client_last_name" required></label>
  <label>Email <input name="client_email" type="email" required></label>
  <label>Phone <input name="client_phone"></label>
  <label>Business Name <input name="client_business_name"></label>

  <!-- ADDRESS -->
  <h2>Address</h2>
  <label>Street <input name="client_street"></label>
  <label>City <input name="client_city"></label>

  <label>State
    <select name="client_state" required>
      <option value="">Select State</option>
      <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
      <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
      <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
      <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
      <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
      <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
      <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
      <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
      <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
      <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
      <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
      <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
      <option>WI</option><option>WY</option>
    </select>
  </label>

  <label>ZIP <input name="client_zip"></label>
  <label>Country <input name="client_country" value="USA"></label>

  <!-- DOCUMENT -->
  <h2>Document Details</h2>
  <label>Governing State
  <select name="governing_state" required>
    <option value="">Select State</option>
    <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
    <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
    <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
    <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
    <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
    <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
    <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
    <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
    <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
    <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
    <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
    <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
    <option>WI</option><option>WY</option>
  </select>
</label>
  <label>Preferred Deadline <input name="preferred_deadline" type="date"></label>
  <label>Urgency <input name="urgency"></label>
  <label>Details <textarea name="details"></textarea></label>
  <label>File Option <input name="file_option"></label>

  <!-- PARTIES -->
  <h2>Parties</h2>

  <label>Party 1 Name <input name="party1_name"></label>
  <label>Party 1 Role <input name="party1_role"></label>
  <label>Party 1 Email <input name="party1_email"></label>

  <label>Party 2 Name <input name="party2_name"></label>
  <label>Party 2 Role <input name="party2_role"></label>
  <label>Party 2 Email <input name="party2_email"></label>

  <label>Party 3 Name <input name="party3_name"></label>
  <label>Party 3 Role <input name="party3_role"></label>
  <label>Party 3 Email <input name="party3_email"></label>

  <label>Party 4 Name <input name="party4_name"></label>
  <label>Party 4 Role <input name="party4_role"></label>
  <label>Party 4 Email <input name="party4_email"></label>

  <!-- INTERNAL -->
  <h2>Internal</h2>
  <label>Order Status <input name="order_status" value="pending"></label>
  <label>Notes <textarea name="notes"></textarea></label>

  <button type="submit">Submit Intake</button>
</form>

<script>
  /* ============================================================
     CONFIG â€” PSEUDONAME (NO VENDOR COUPLING)
     ============================================================ */

  const ORDER_DB_URL = "https://vvjbjfltqsivvxxifnvi.supabase.co";
  const ORDER_DB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q";

  const orderDB = supabase.createClient(ORDER_DB_URL, ORDER_DB_KEY);

  /* ============================================================
     ORDER ID GENERATION (AUTHORITATIVE)
     ============================================================ */

  function generateOrderId() {
    const d = new Date().toISOString().slice(0,10).replace(/-/g,'');
    const r = Math.floor(1000 + Math.random() * 9000);
    return `ELB-${d}-${r}`;
  }

  /* ============================================================
     SUBMIT HANDLER
     ============================================================ */

  document.getElementById("intakeForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const payload = Object.fromEntries(formData.entries());

    // Canonical identifiers
    payload.request_uuid = crypto.randomUUID();
    payload.order_id = generateOrderId();

    const { error } = await orderDB
      .from("pweb_orders")
      .insert([payload]);

    if (error) {
      console.error(error);
      alert("ERROR submitting intake: " + error.message);
      return;
    }

    // ðŸš€ FLOW CONTINUES HERE
    window.location.href = `/review-and-pay.html?order_id=${payload.order_id}`;
  });
</script>

</body>
</html>
