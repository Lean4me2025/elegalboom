<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Operating Agreement Intake</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial; background:#f4f6f9; padding:40px; }
.container { max-width:800px; margin:auto; background:white; padding:40px; border-radius:8px; }
input, textarea { width:100%; padding:10px; margin-bottom:15px; }
button { padding:10px 15px; }
.primary { background:#1e3a8a; color:white; border:none; }
.secondary { background:#ccc; border:none; }
</style>
</head>

<body>

<div class="container">
<h2>Single-Member LLC Operating Agreement</h2>

<h3>Client Information</h3>

<label>First Name</label>
<input id="client_first_name">

<label>Last Name</label>
<input id="client_last_name">

<label>Email</label>
<input id="client_email">

<label>Phone</label>
<input id="client_phone">

<label>Governing State</label>
<input id="governing_state">

<label>Agreement Date</label>
<input id="agreement_date" type="date">

<h3>LLC Details</h3>

<label>LLC Name</label>
<input id="llc_name">

<label>Member Name</label>
<input id="member_name">

<label>Member Address</label>
<input id="member_address">

<label>Principal Business Address</label>
<input id="principal_business_address">

<label>Capital Contribution Description</label>
<textarea id="capital_contribution_description"></textarea>

<button class="primary" onclick="submitIntake()">Confirm & Continue</button>

</div>

<script>

const SUPABASE_URL = "https://vvjbjfltqsivvxxifnvi.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

async function submitIntake() {

  const orderRaw = sessionStorage.getItem("legal_selected_order");

  if (!orderRaw) {
    alert("Order not found in session.");
    return;
  }

  const order = JSON.parse(orderRaw);

  if (!order.order_id) {
    alert("Order ID missing.");
    console.log(order);
    return;
  }

  const intakePayload = {
    llc_name: document.getElementById("llc_name").value,
    agreement_date: document.getElementById("agreement_date").value,
    member_name: document.getElementById("member_name").value,
    member_address: document.getElementById("member_address").value,
    principal_business_address: document.getElementById("principal_business_address").value,
    capital_contribution_description: document.getElementById("capital_contribution_description").value
  };

  const { error } = await supabaseClient
    .from("pweb_orders")
    .update({
      client_first_name: document.getElementById("client_first_name").value,
      client_last_name: document.getElementById("client_last_name").value,
      client_email: document.getElementById("client_email").value,
      client_phone: document.getElementById("client_phone").value,
      governing_state: document.getElementById("governing_state").value,
      intake_json: intakePayload,
      order_status: "intake_complete"
    })
    .eq("order_id", order.order_id);

  if (error) {
    console.error(error);
    alert("Error saving intake.");
    return;
  }

  window.location.href = "review.html";
}

</script>

</body>
</html>
