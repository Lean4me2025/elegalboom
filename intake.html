<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom | Intake Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Your main stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ðŸ”´ REPLACE THESE WITH YOUR REAL VALUES
    const SUPABASE_URL = "https://vvjbjfltqsivvxxifnvi.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q";

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <style>
    /* Light, safe defaults in case style.css is minimal */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background-color: #f5f5f7;
      color: #222;
    }
    .site-header, .site-footer {
      background-color: #111827;
      color: #f9fafb;
      padding: 12px 20px;
    }
    .site-header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    .site-header p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      opacity: 0.8;
    }
    .main-nav a {
      color: #e5e7eb;
      text-decoration: none;
      margin-right: 16px;
      font-size: 0.9rem;
    }
    .main-nav a:hover {
      text-decoration: underline;
    }
    .page-content {
      max-width: 900px;
      margin: 20px auto 40px;
      background: #ffffff;
      padding: 20px 20px 32px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .form-intro h2 {
      margin-top: 0;
    }
    form label {
      display: block;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }
    form input[type="text"],
    form input[type="email"],
    form input[type="tel"],
    form select,
    form textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px 10px;
      margin-top: 4px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
    }
    form textarea {
      resize: vertical;
    }
    fieldset {
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 10px 12px;
      margin-bottom: 12px;
    }
    fieldset legend {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }
    .btn-primary {
      background-color: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      font-size: 0.95rem;
      cursor: pointer;
    }
    .btn-primary:hover {
      background-color: #1d4ed8;
    }
    .small-note {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .section-title {
      margin-top: 20px;
      font-size: 1.05rem;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
      margin-bottom: 12px;
    }
    .error-message {
      color: #b91c1c;
      font-size: 0.85rem;
      margin-bottom: 10px;
      display: none;
    }
  </style>
</head>
<body>

<header class="site-header">
  <div>
    <h1>E-LegalBoom</h1>
    <p>Secure, structured intake for your custom legal documents</p>
  </div>
  <nav class="main-nav">
    <a href="index.html">Home</a>
    <a href="catalog.html">Catalog</a>
    <a href="bundle.html">Bundles</a>
  </nav>
</header>

<main class="page-content">

  <section class="form-intro">
    <h2>Client Intake</h2>
    <p>
      Please complete this intake form. Your responses will be used to
      prepare the framework of your legal document. You will review
      and approve the final version before it is used.
    </p>
    <p class="small-note">
      Fields marked with * are required. Some options (management, dispute resolution, etc.)
      may not apply to every document type; you may leave them blank when not relevant.
    </p>
  </section>

  <section class="form-section">
    <div id="error-box" class="error-message"></div>

    <form id="intake-form">

      <!-- Hidden: document type & tier from URL -->
      <input type="hidden" id="doc_type" name="doc_type">
      <input type="hidden" id="tier" name="tier">

      <!-- 1. Contact Information -->
      <div class="section-title">1. Contact Information</div>

      <label>
        Full Name *
        <input type="text" name="customer_name" required>
      </label>

      <label>
        Email Address *
        <input type="email" name="customer_email" required>
      </label>

      <label>
        Phone (optional)
        <input type="tel" name="customer_phone">
      </label>

      <!-- 2. Entity Information -->
      <div class="section-title">2. Entity / Relationship Information</div>

      <label>
        Entity Type *
        <select name="entity_type" required>
          <option value="">Select entity type...</option>
          <option value="individual">Individual</option>
          <option value="partnership">Partnership</option>
          <option value="llc">LLC</option>
          <option value="corporation">Corporation</option>
          <option value="trust">Trust</option>
          <option value="other">Other</option>
        </select>
      </label>

      <label>
        Entity / Business / Trust Name
        <input type="text" name="entity_name">
      </label>

      <label>
        Governing State / Jurisdiction *
        <select name="governing_state" required>
          <option value="">Select state...</option>
          <option>Alabama</option><option>Alaska</option><option>Arizona</option>
          <option>Arkansas</option><option>California</option><option>Colorado</option>
          <option>Connecticut</option><option>Delaware</option><option>Florida</option>
          <option>Georgia</option><option>Hawaii</option><option>Idaho</option>
          <option>Illinois</option><option>Indiana</option><option>Iowa</option>
          <option>Kansas</option><option>Kentucky</option><option>Louisiana</option>
          <option>Maine</option><option>Maryland</option><option>Massachusetts</option>
          <option>Michigan</option><option>Minnesota</option><option>Mississippi</option>
          <option>Missouri</option><option>Montana</option><option>Nebraska</option>
          <option>Nevada</option><option>New Hampshire</option><option>New Jersey</option>
          <option>New Mexico</option><option>New York</option><option>North Carolina</option>
          <option>North Dakota</option><option>Ohio</option><option>Oklahoma</option>
          <option>Oregon</option><option>Pennsylvania</option><option>Rhode Island</option>
          <option>South Carolina</option><option>South Dakota</option><option>Tennessee</option>
          <option>Texas</option><option>Utah</option><option>Vermont</option>
          <option>Virginia</option><option>Washington</option><option>West Virginia</option>
          <option>Wisconsin</option><option>Wyoming</option>
        </select>
      </label>

      <label>
        Names of Other Parties / Members / Trustees / Partners
        <textarea name="other_parties" rows="3" placeholder="List other individuals or entities involved, separated by commas."></textarea>
      </label>

      <!-- 3. Ownership & Financial Terms (especially for partnerships / LLCs) -->
      <div class="section-title">3. Ownership & Financial Terms</div>

      <label>
        Ownership Percentages (if applicable)
        <textarea name="ownership_split" rows="2" placeholder="Example: Partner A 60%, Partner B 40%."></textarea>
      </label>

      <label>
        Capital Contributions Description
        <textarea name="capital_contrib" rows="3" placeholder="Describe who is contributing what (cash, property, services, crypto, etc.)."></textarea>
      </label>

      <label>
        Profit & Loss Split
        <textarea name="profit_loss_split" rows="2" placeholder="Example: Profits and losses shared in proportion to ownership."></textarea>
      </label>

      <!-- 4. Key Business Terms / Controls -->
      <div class="section-title">4. Management, Disputes & Restrictions</div>

      <label>
        Management Structure (optional)
        <select name="management_model">
          <option value="">Select...</option>
          <option value="managing_partner">Managing Partner</option>
          <option value="equal_authority">Equal Authority</option>
          <option value="vote_based">Vote-Based Authority</option>
          <option value="custom">Custom / Describe in Notes</option>
        </select>
      </label>

      <label>
        Dispute Resolution (optional)
        <select name="dispute_method">
          <option value="">Select...</option>
          <option value="arbitration">Arbitration</option>
          <option value="court">Court Litigation</option>
          <option value="mediation_then_arbitration">Mediation then Arbitration</option>
          <option value="mediation_then_court">Mediation then Court</option>
          <option value="custom">Custom / Describe in Notes</option>
        </select>
      </label>

      <label>
        Non-Compete (optional)
        <select name="non_compete_option">
          <option value="">Select...</option>
          <option value="include">Include Non-Compete Clause</option>
          <option value="exclude">Do NOT Include Non-Compete Clause</option>
          <option value="custom">Custom / Describe in Notes</option>
        </select>
      </label>

      <fieldset>
        <legend>Capital Contributions (check all that apply)</legend>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="cash" id="cap_cash">
          <label for="cap_cash">Cash</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="property" id="cap_property">
          <label for="cap_property">Property</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="services" id="cap_services">
          <label for="cap_services">Services</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="cryptocurrency" id="cap_crypto">
          <label for="cap_crypto">Cryptocurrency</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="ip" id="cap_ip">
          <label for="cap_ip">Intellectual Property</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="capital_types[]" value="custom" id="cap_custom">
          <label for="cap_custom">Other (describe in notes)</label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Optional Special Clauses (check all that apply)</legend>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="non_solicitation" id="sc_non_solicit">
          <label for="sc_non_solicit">Non-Solicitation</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="ip_assignment" id="sc_ip_assign">
          <label for="sc_ip_assign">Intellectual Property Assignment</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="buyout_rules" id="sc_buyout">
          <label for="sc_buyout">Buyout Rules</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="succession" id="sc_succession">
          <label for="sc_succession">Succession Clause</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="rofr" id="sc_rofr">
          <label for="sc_rofr">Right of First Refusal</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="drag_tag" id="sc_drag_tag">
          <label for="sc_drag_tag">Drag-Along / Tag-Along</label>
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="special_clauses[]" value="custom" id="sc_custom">
          <label for="sc_custom">Other (describe in notes)</label>
        </div>
      </fieldset>

      <!-- 5. Special Notes -->
      <div class="section-title">5. Special Instructions / Notes</div>

      <label>
        Special Instructions or Notes
        <textarea name="special_notes" rows="4" placeholder="Anything you want emphasized, clarified, or customized."></textarea>
      </label>

      <!-- 6. Confirmations -->
      <div class="section-title">6. Confirmations</div>

      <div class="checkbox-row">
        <input type="checkbox" id="confirm_accuracy" required>
        <label for="confirm_accuracy">
          I confirm that the information provided is accurate to the best of my knowledge.
        </label>
      </div>

      <div class="checkbox-row">
        <input type="checkbox" id="confirm_no_legal_advice" required>
        <label for="confirm_no_legal_advice">
          I understand E-LegalBoom provides document frameworks only and does not provide legal advice
          or create an attorneyâ€“client relationship.
        </label>
      </div>

      <button type="submit" class="btn-primary">
        Submit &amp; Continue to Payment
      </button>
    </form>
  </section>
</main>

<footer class="site-footer">
  <p>&copy; 2025 E-LegalBoom. All rights reserved.</p>
</footer>

<script>
  // Pull doc_type and tier from the URL into hidden fields
  (function syncQueryParams() {
    const params = new URLSearchParams(window.location.search);
    const docType = params.get('doc_type');
    const tier = params.get('tier');

    if (docType) {
      const dt = document.getElementById('doc_type');
      if (dt) dt.value = docType;
    }
    if (tier) {
      const t = document.getElementById('tier');
      if (t) t.value = tier;
    }
  })();

  const form = document.getElementById('intake-form');
  const errorBox = document.getElementById('error-box');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    errorBox.style.display = 'none';
    errorBox.textContent = '';

    // Collect all fields
    const formData = new FormData(form);

    // Multi-select arrays
    const capitalTypes = [];
    document.querySelectorAll('input[name="capital_types[]"]:checked')
      .forEach(cb => capitalTypes.push(cb.value));

    const specialClauses = [];
    document.querySelectorAll('input[name="special_clauses[]"]:checked')
      .forEach(cb => specialClauses.push(cb.value));

    // Turn into plain object for JSON
    const payload = Object.fromEntries(formData.entries());

    try {
      const { data, error } = await supabaseClient
        .from('document_requests')
        .insert([{
          doc_type: payload.doc_type || null,
          customer_name: payload.customer_name,
          customer_email: payload.customer_email,
          entity_type: payload.entity_type,
          governing_state: payload.governing_state,
          entity_name: payload.entity_name || null,

          // decision fields
          management_model: payload.management_model || null,
          dispute_method: payload.dispute_method || null,
          non_compete_option: payload.non_compete_option || null,
          capital_types: capitalTypes,
          special_clauses: specialClauses,

          status: 'new',

          // full raw payload for engine use later
          data: {
            ...payload,
            capital_types: capitalTypes,
            special_clauses: specialClauses
          }
        }]);

      if (error) {
        console.error('Supabase insert error:', error);
        errorBox.textContent = 'There was an error submitting your intake. Please try again.';
        errorBox.style.display = 'block';
        return;
      }

      // On success, go to payment page
      window.location.href = 'payment.html';
    } catch (err) {
      console.error('Unexpected error:', err);
      errorBox.textContent = 'An unexpected error occurred. Please try again.';
      errorBox.style.display = 'block';
    }
  });
</script>

</body>
</html>
