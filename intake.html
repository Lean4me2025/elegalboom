<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>E-LegalBoom – Intake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h1>Document Intake</h1>

  <p id="orderSummary" style="font-weight:600;"></p>

  <form id="intakeForm">
    <label>
      Full Name
      <input type="text" id="full_name" required />
    </label>

    <label>
      Email
      <input type="email" id="email" required />
    </label>

    <label>
      Details / Notes
      <textarea id="details"></textarea>
    </label>

    <label>
      Urgency
      <select id="urgency">
        <option value="standard">Standard</option>
        <option value="rush">Rush</option>
      </select>
    </label>

    <label>
      File Option
      <select id="file_option">
        <option value="pdf">PDF</option>
        <option value="docx">Word</option>
      </select>
    </label>

    <button type="submit">Continue to Payment</button>
  </form>

<script>
/* ============================================================
   1. READ CONTEXT FROM URL (TIERS ARE SOURCE OF TRUTH)
   ============================================================ */

const params = new URLSearchParams(window.location.search);
const tier = params.get("tier");
const doc = params.get("doc");

const PRICES = {
  "1": 39,
  "2": 59,
  "3": 399,
  "4": 0
};

const amount = PRICES[tier] ?? 0;

document.getElementById("orderSummary").textContent =
  `You selected: ${doc || "Document"} (Tier ${tier || "?"}) – $${amount}`;

/* ============================================================
   2. HANDLE INTAKE SUBMIT (NO GUARDS, NO REDIRECT BLOCKERS)
   ============================================================ */

document.getElementById("intakeForm").addEventListener("submit", (e) => {
  e.preventDefault();

  const fullName = document.getElementById("full_name").value.trim();
  const email = document.getElementById("email").value.trim();
  const details = document.getElementById("details").value.trim();
  const urgency = document.getElementById("urgency").value;
  const fileOption = document.getElementById("file_option").value;

  if (!fullName || !email) {
    alert("Name and email are required.");
    return;
  }

  const nameParts = fullName.split(" ");
  const firstName = nameParts.shift() || "";
  const lastName = nameParts.join(" ");

  const intakeRecord = {
    request_uuid: crypto.randomUUID(),
    client_first_name: firstName,
    client_last_name: lastName,
    client_email: email,
    doc_type: doc,
    tier: tier,
    amount: amount,
    urgency: urgency,
    details: details,
    file_option: fileOption,
    order_status: "intake_complete"
  };

  sessionStorage.setItem("intakeRecord", JSON.stringify(intakeRecord));

  window.location.href = "payment.html";
});
</script>

</body>
</html>
