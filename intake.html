<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Client Intake â€“ Step 1 | E-LegalBoom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Simple default styling in case style.css isn't loaded */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f8fb;
      color: #0f172a;
    }
    .page {
      max-width: 960px;
      margin: 28px auto 48px;
      padding: 0 18px;
    }
    h1 {
      font-size: 1.9rem;
      margin-bottom: 6px;
      color: #0b7285;
    }
    .subtitle {
      font-size: 0.98rem;
      color: #475569;
      max-width: 780px;
      line-height: 1.5;
    }
    .summary {
      margin-top: 14px;
      padding: 12px 14px;
      background: #eff6ff;
      border-left: 4px solid #2563eb;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #1e293b;
    }
    .summary strong {
      color: #0f172a;
    }
    form {
      margin-top: 24px;
      padding: 18px 16px 22px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }
    .section-title {
      margin-top: 4px;
      margin-bottom: 10px;
      font-size: 1.02rem;
      font-weight: 600;
      color: #0f172a;
    }
    label {
      display: block;
      margin-top: 12px;
      font-size: 0.9rem;
      color: #0f172a;
    }
    .required-badge {
      display: inline-block;
      margin-left: 4px;
      font-size: 0.7rem;
      padding: 1px 6px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea {
      width: 100%;
      margin-top: 4px;
      padding: 8px 9px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    textarea {
      min-height: 72px;
      resize: vertical;
    }
    .hint {
      font-size: 0.78rem;
      color: #64748b;
      margin-top: 2px;
    }
    .status {
      margin-top: 16px;
      font-size: 0.9rem;
      min-height: 1.2em;
    }
    .status.success {
      color: #15803d;
    }
    .status.error {
      color: #b91c1c;
    }
    button[type="submit"] {
      margin-top: 18px;
      padding: 10px 18px;
      background: #0b7285;
      color: white;
      border: none;
      border-radius: 999px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    button[disabled] {
      opacity: 0.65;
      cursor: default;
    }
    .tier-row {
      font-size: 0.9rem;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>Client Intake â€“ Step 1</h1>
    <div class="subtitle">
      Tell us about your business and document needs. After this step, youâ€™ll be taken to
      payment to complete your E-LegalBoom order.
    </div>

    <div class="summary">
      <div class="tier-row">
        <strong>Tier selected:</strong>
        <span id="tierLabel">(none selected)</span>
      </div>
      <div class="tier-row">
        <strong>Pricing:</strong>
        <span id="tierPrice">(per document)</span>
      </div>
      <div class="tier-row">
        <strong>Note:</strong>
        <span id="tierNote">Each order covers one set of documents within a 30-day window.</span>
      </div>
    </div>

    <form id="intakeForm">
      <!-- Hidden fields -->
      <input type="hidden" id="tierCode"   name="tier"   value="">
      <input type="hidden" id="stage"      name="stage"  value="intake">
      <input type="hidden" id="docType"    name="docType" value="">
      <input type="hidden" id="intakeId"   name="intakeId" value="">

      <div class="section-title">Section 1 â€“ Contact & basic information</div>

      <label for="fullName">
        Full name
        <span class="required-badge">Required</span>
      </label>
      <input type="text" id="fullName" name="fullName" required>

      <label for="email">
        Email address
        <span class="required-badge">Required</span>
      </label>
      <input type="email" id="email" name="email" required>

      <label for="phone">Phone number (optional)</label>
      <input type="tel" id="phone" name="phone">

      <label for="state">
        State where your business operates
        <span class="required-badge">Required</span>
      </label>
      <input type="text" id="state" name="state" required>

      <label for="businessName">
        Business / organization name
        <span class="required-badge">Required</span>
      </label>
      <input type="text" id="businessName" name="businessName" required>

      <label for="businessDescription">
        Briefly describe what your business does
      </label>
      <textarea id="businessDescription" name="businessDescription"></textarea>
      <div class="hint">A sentence or two is enough. This helps us align the documents to your actual work.</div>

      <label for="primaryGoal">
        What is your primary goal for this document order?
      </label>
      <textarea id="primaryGoal" name="primaryGoal"></textarea>

      <button type="submit">Submit &amp; Go to Payment â†’</button>

      <div class="status" id="statusMessage"></div>
    </form>
  </div>

  <script>
    // ðŸ”— YOUR APPS SCRIPT WEB APP URL
    const SCRIPT_URL = "PASTE_YOUR_WEB_APP_URL_HERE"; // e.g. https://script.google.com/macros/s/XXXX/exec

    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function mapTierLabel(code) {
      const c = (code || "").toUpperCase();
      if (c === "T1") return "Tier 1 â€“ Startup & Essential Documents";
      if (c === "T2") return "Tier 2 â€“ Business Foundation Documents";
      if (c === "T3") return "Tier 3 â€“ Premium Business Agreements";
      if (c === "ENT") return "Entrepreneur Starter Bundle";
      return "No tier selected";
    }

    function mapTierPrice(code) {
      const c = (code || "").toUpperCase();
      if (c === "T1") return "$399 per document";
      if (c === "T2") return "$599 per document";
      if (c === "T3") return "$799 per document";
      if (c === "ENT") return "$149 flat (multiple documents within 30-day window)";
      return "(per document)";
    }

    function mapTierNote(code) {
      const c = (code || "").toUpperCase();
      if (c === "ENT") {
        return "Entrepreneur bundle covers multiple documents started within 30 days of purchase.";
      }
      return "Each order covers one document (or document set) within a 30-day window.";
    }

    document.addEventListener("DOMContentLoaded", () => {
      const tierCode = getParam("tier") || "";
      const tierInput = document.getElementById("tierCode");
      if (tierInput) tierInput.value = tierCode;

      const labelEl = document.getElementById("tierLabel");
      const priceEl = document.getElementById("tierPrice");
      const noteEl  = document.getElementById("tierNote");

      if (labelEl) labelEl.textContent = mapTierLabel(tierCode);
      if (priceEl) priceEl.textContent = mapTierPrice(tierCode);
      if (noteEl)  noteEl.textContent  = mapTierNote(tierCode);
    });

    const form = document.getElementById("intakeForm");
    const statusEl = document.getElementById("statusMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status";

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "Submittingâ€¦";

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      if (!data.stage) data.stage = "intake";

      try {
        const resp = await fetch(SCRIPT_URL, {
          method: "POST",
          // SIMPLE content type so the browser does NOT send a preflight OPTIONS
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(data)
        });

        const rawText = await resp.text();
        let json;
        try {
          json = JSON.parse(rawText);
        } catch (parseErr) {
          throw new Error("Invalid JSON from server: " + rawText);
        }

        if (!resp.ok || !json.success) {
          throw new Error(json.error || "Unknown error");
        }

        const tierCode = data.tier || "";
        const intakeId = json.intakeId || "";
        let nextUrl = "orders.html";

        const params = new URLSearchParams();
        if (tierCode) params.set("tier", tierCode);
        if (intakeId) params.set("intakeId", intakeId);
        if (data.docType) params.set("docType", data.docType);

        if ([...params.keys()].length > 0) {
          nextUrl += "?" + params.toString();
        }

        statusEl.textContent = "Intake saved. Redirecting to paymentâ€¦";
        statusEl.classList.add("success");

        window.location.href = nextUrl;
      } catch (err) {
        console.error("Submit error:", err);
        statusEl.textContent =
          "There was a problem saving your intake. Please try again or contact us.";
        statusEl.classList.add("error");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit & Go to Payment â†’";
      }
    });
  </script>
</body>
</html>
